<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">	

<mapper namespace="com.test.mybatis.dao.IProjectPageDAO">

	<select id="pjdto" resultType="com.test.mybatis.dto.ProjectPageDTO">
		SELECT  AP.AP_CODE, AP.TITLE, AP.SUMMARY, TO_CHAR(AP.SDATE,'YYYY-MM-DD') AS SDATE, TO_CHAR(AP.EDATE,'YYYY-MM-DD') AS EDATE, AP.CONTENT, TO_CHAR(AP.KDATE,'YYYY-MM-DD') AS KDATE, AP.NUMBERS, AP.VIEWS, AP.MEM_CODE, COUNT(*) AS COUNT, M.NICKNAME
		FROM AO_COMMENT AC JOIN  AO_REPLY2 A2 ON AC.AC_CODE=A2.AC_CODE
		                    JOIN APP_OPENING AP ON AC.AP_CODE = AP.AP_CODE
		                    JOIN MEMBER M ON AC.MEM_CODE = M.MEM_CODE
		WHERE AC.AP_CODE IN (SELECT CP.AP_CODE
		                FROM ROLE_COMP RC JOIN MEMBER_APPLY MA ON MA.RC_CODE = RC.RC_CODE
		                                    JOIN C_PROJECT CP ON RC.AP_CODE = CP.AP_CODE
		                WHERE AR_CODE = 'AR0001'AND MEM_CODE = #{mem_code}) AND SYSDATE >= AP.SDATE AND AP.EDATE >= SYSDATE
		GROUP BY AP.AP_CODE, AP.TITLE, AP.SUMMARY, AP.SDATE, AP.EDATE, AP.CONTENT, AP.KDATE, AP.NUMBERS, AP.VIEWS, AP.MEM_CODE, M.NICKNAME
		
	</select>
	
	<select id="pjtagap" resultType="com.test.mybatis.dto.ProjectPageDTO">
		SELECT AP_CODE, TAG_NAME
		FROM OPEN_TAG
		WHERE AP_CODE = (SELECT CP.AP_CODE
		                FROM ROLE_COMP RC JOIN MEMBER_APPLY MA ON MA.RC_CODE = RC.RC_CODE
		                                    JOIN C_PROJECT CP ON RC.AP_CODE = CP.AP_CODE
		                WHERE AR_CODE = 'AR0001' AND MEM_CODE = #{mem_code})
		  
	</select>
	
	<select id="allpjlist" resultType="com.test.mybatis.dto.ProjectPageDTO">
		SELECT AP_CODE, TAG_NAME
		FROM OPEN_TAG
		WHERE AP_CODE = (SELECT CP.AP_CODE
		                FROM ROLE_COMP RC JOIN MEMBER_APPLY MA ON MA.RC_CODE = RC.RC_CODE
		                                    JOIN C_PROJECT CP ON RC.AP_CODE = CP.AP_CODE
		                WHERE AR_CODE = 'AR0001' AND MEM_CODE = #{mem_code})
		  
	</select>

</mapper>