<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">				

<!-- 루트 엘리먼트 -->
<!-- namespace는 인터페이스 경로를 지정하면 된다.
인터페이스와 연결되는 무언가를 만들겠다.          
IMemberDAO의 역할을 MemberDAO.xml 이 하겠다. 				-->
<mapper namespace="com.test.mybatis.dao.IMemberDAO">

	<!-- list()를 구현하기 위해서 select 가 필요하다 -->
	<!-- id 속성에는 메소드 이름이 들어감 , 개행 공백 규칙 sqldeveloper과 같음-->
	<!-- resultType : 반환하는 결과 타입 select 결과 MemberDTO 타입이 하나씩 나온다.-->
	<select id="list" resultType="com.test.mybatis.dto.MemberDTO">
		SELECT MEM_CODE, ID, PW, NICKNAME, MBTI_CODE
		FROM MEMBER
		ORDER BY MEM_CODE
	</select>
	
	<select id="login" resultType="com.test.mybatis.dto.MemberDTO" >
		SELECT MEM_CODE, ID, PW, NICKNAME, MBTI_CODE
		FROM MEMBER
		WHERE PW = #{arg1} AND ID = #{arg0}
	</select>
	
	<!-- 정수반환 하므로 resultType에 Integer 넣어준다. -->
	<select id="count" resultType="java.lang.Integer">
		SELECT COUNT(*) AS COUNT
		FROM MEMBER
	</select>
	
	<!-- parameterType="com.test.mybatis.MemberDTO" -->
	<insert id="add">
	<!-- <insert id="add" parameterType="String"> -->
		INSERT INTO MEMBER(MEM_CODE, ID, PW, NICKNAME, MBTI_CODE)
		VALUES(MEM_SEQ.NEXTVAL, #{id}, #{pw}, #{nickname}, #{mbti_code})
	</insert>
	
	<delete id="remove">
		DELETE
		FROM MEMBER
		WHERE MEM_CODE = ${mem_code}
	</delete>
	
	<!-- member, mem_info 동시에 넣는 프로시저 -->
	<insert id="memberJoin" statementType="CALLABLE">
		{CALL MEMBER_JOIN (#{arg0}, #{arg1}, #{arg2})}
	</insert>
	
	<!-- 프로젝트의 팀장 가져오는 쿼리 -->
	<select id="getLeader" resultType="com.test.mybatis.dto.MemberDTO">
		SELECT MEM_CODE, ID, PW, NICKNAME, MBTI_CODE
		FROM MEMBER
		WHERE MEM_CODE IN (SELECT MEM_CODE 
						  FROM MEMBER_APPLY M JOIN ROLE_COMP R ON M.RC_CODE = R.RC_CODE
						  WHERE AP_CODE = #{arg0} AND MR_CODE = #{arg1}) 
	</select>
	
	<!--  프로젝트의 프론트 가져오는 쿼리 -->
	<select id="getFront" resultType="com.test.mybatis.dto.MemberDTO" >
		SELECT MEM_CODE, ID, PW, NICKNAME, MBTI_CODE
		FROM MEMBER
		WHERE MEM_CODE IN (SELECT MEM_CODE 
						  FROM MEMBER_APPLY M JOIN ROLE_COMP R ON M.RC_CODE = R.RC_CODE
						  WHERE AP_CODE = 'AP0006' AND MR_CODE = 'MR0002')
	</select>
	
	<!-- 프로젝트의 백 가져오는 쿼리 -->
	<select id="getBack" resultType="com.test.mybatis.dto.MemberDTO" >
		SELECT MEM_CODE, ID, PW, NICKNAME, MBTI_CODE
		FROM MEMBER
		WHERE MEM_CODE IN (SELECT MEM_CODE 
						  FROM MEMBER_APPLY M JOIN ROLE_COMP R ON M.RC_CODE = R.RC_CODE
						  WHERE AP_CODE = 'AP0006' AND MR_CODE = 'MR0003') 
	</select>
	 
</mapper>































